<!-- For help on using this template, see the blog post: https://blog.mturk.com/editing-the-survey-link-project-template-in-the-ui-7c75285105fb#.py7towsdx --><!-- HIT template: SurveyLink-v3.0 --><!-- The following snippet enables the 'responsive' behavior on smaller screens -->
<meta content="width=device-width,initial-scale=1" name="viewport" />
<section class="container" id="SurveyLink"><!-- Instructions -->
    <div class="row">
        <div class="col-xs-12 col-md-12">
            <div class="panel panel-primary"><!-- WARNING: the ids "collapseTrigger" and "instructionBody" are being used to enable expand/collapse feature --><a class="panel-heading" href="javascript:void(0);" id="collapseTrigger"><strong>Survey Link Instructions</strong> <span class="collapse-text">(Click to expand)</span> </a>
                <div class="panel-body" id="instructionBody">
                    <p>We are conducting an academic survey about social networks. We need to understand your opinion about social networks. Select the link below to complete the survey. At the end of the survey, you will receive a code to paste into the box below to receive credit for taking our survey.</p>

                    <p><strong>Make sure to leave this window open as you complete the survey. </strong> When you are finished, you will return to this page to paste the code into the box.</p>

                    <p class="well well-sm"><strong><mark>Template note for Requesters</mark></strong> - To verify that Workers actually complete your survey, require each Worker to enter a <strong>unique</strong> survey completion code to your HIT. Consult with your survey service provider on how to generate this code at the end of your survey.</p>
                </div>
            </div>
        </div>
    </div>
    <!-- End Instructions --><!-- Survey Link Layout -->

    <div class="row" id="workContent">
        <div class="col-xs-12 col-md-6 col-md-offset-3">

            <!-- Content for Worker -->

            <div style="font-family:sans-serif;margin-left:10%;margin-right:10%;">

                <!-- THIS IS WHERE THE LINK WILL APPEAR -->
                <span id='link'>Link will appear here once HIT is accepted. If it does not, make sure javascript is enabled in your browser.</span>

                <script type="text/javascript">
                  var surveyUrl = "https://elicit.compute.dtu.dk/studies/54/protocols/52";
                  // RETRIEVE URL
                  var fullurl=new String();
                  // THIS IS THE LINE TO CAPTURE THE ACTUAL URL:
                  var fullurl=document.location.href;


                  // START TEST CODE (DELETE THIS SECTION BEFORE PUTTING INTO MTURK)

                  // USE THIS LINE TO TEST THAT THE CODE IS WORKING FOR A REAL MTURK ASSIGNMENT:
                  // var fullurl="https://s3.amazonaws.com/mturk_bulk/hits/46029244/xIpb71zULpXQALR7MKF2DA.html?assignmentId=2PB51Y7QEOZFH9JGPVKMUFXTFYWGDA&hitId=2OMJ79KQW6186NX9AI3DA5XC8D2JL4&workerId=A1RO9EXAMPLE65&turkSubmitTo=https%3A%2F%2Fwww.mturk.com";
                  // USE THIS LINE TO TEST THAT THE CODE IS WORKING FOR "PREVIEW" MODE:
                  // var fullurl="https://s3.amazonaws.com/mturk_bulk/hits/46029244/xIpb71zULpXQALR7MKF2DA.html?assignmentId=ASSIGNMENT_ID_NOT_AVAILABLE";

                  // END TEST CODE


                  // FUNCTION TO EXTRACT A URL PARAMETER (FROM: https://s3.amazonaws.com/mturk-public/externalHIT_v1.js)
                  function turkGetParam( name ) {
                    var regexS = "[\?&]"+name+"=([^&#]*)";
                    var regex = new RegExp( regexS );
                    var tmpURL = fullurl;
                    var results = regex.exec( tmpURL );
                    if( results == null ) {
                      return "";
                    } else {
                      return results[1];
                    }
                  }

                  // ASSIGNS THE URL PARAMETERS TO JAVASCRIPT VARIABLES
                  var assign = turkGetParam('assignmentId');
                  var hit = turkGetParam('hitId');
                  var worker = turkGetParam('workerId');

                  // THIS PART BUILDS THE LINK FOR AN ACCEPTED ASSIGNMENT
                  if(assign=="ASSIGNMENT_ID_NOT_AVAILABLE") {
                    // THIS IS A MESSAGE ABOUT THE HIT BEING IN PREVIEW MODE (SO IT WON'T SHOW THE LINK)
                    document.getElementById('link').innerHTML = "<p style='font-weight:bold;text-align:center;'>Link will become available once you accept the HIT.</p>";
                  } else {
                    // CONSTRUCT THE SURVEY LINK WITH THE EMBEDDED VALUES:
                    var surveylink = new String(surveyUrl+"/?"
                      + "assignmentId=" + assign
                      + "&hitId=" + hit
                      + "&workerId=" + worker
                    );
                    // IN QUALTRICS, THESE PARAMETERS CAN BE RETRIEVED AND USED IN THE SURVEY BY RETRIEVED 'EMBEDDED VALUES' AND USING AS 'PIPED TEXT'
                    // IN SURVEY MONKEY, ONE VALUE (OR A CONCATENATION OF VALUES) CAN BE SENT TO (AND SAVED BY) THE SURVEY BUT NOT PIPED
                    // E.G., var surveylink = new String("http://www.survey.com/surveylink?c=" + worker");
                    // IN GOOGLE FORMS, PARAMETERS CAN BE PIPED TO FORM ENTRY FIELDS
                    /* E.G., var surveylink = new String("http://spreadsheets.google.com/viewform?formkey=12345"
                             + "&entry_0=" + assign
                             + "&entry_1=" + hit
                             + "&entry_2=" + worker);
                    */
                    // DISPLAY THE LINK
                    document.getElementById('link').innerHTML = "<p><a href='" + surveylink + "' target='_blank'>Complete this survey</a></p>";
                  }
                </script>
            </div>
            <!-- End Content for Worker -->


            <!-- Input from Worker -->

            <div class="form-group"><label for="surveycode">Provide the survey code here:</label> <input class="form-control" id="surveycode" name="surveycode" placeholder="e.g. 123456" required="" type="text" /></div>
            <!-- End input from Worker -->
        </div>
    </div>



    <!-- End Survey Link Layout --></section>
<!-- Please note that Bootstrap CSS/JS and JQuery are 3rd party libraries that may update their url/code at any time. Amazon Mechanical Turk (MTurk) is including these libraries as a default option for you, but is not responsible for any changes to the external libraries --><!-- External CSS references -->
<link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css" integrity="sha384-IS73LIqjtYesmURkDE9MXKbXqYA8rvKEp/ghicjem7Vc3mGRdQRptJSz60tvrB6+" rel="stylesheet" /><!-- Open internal style sheet -->
<style type="text/css">#collapseTrigger{
    color:#fff;
    display: block;
    text-decoration: none;
}
#submitButton{
    white-space: normal;
}
.image{
    margin-bottom: 15px;
}
/* CSS for breaking long words/urls */
.dont-break-out {
    overflow-wrap: break-word;
    word-wrap: break-word;
    -ms-word-break: break-all;
    word-break: break-all;
    word-break: break-word;
    -ms-hyphens: auto;
    -moz-hyphens: auto;
    -webkit-hyphens: auto;
    hyphens: auto;
}
</style>
<!-- Close internal style sheet --><!-- External JS references --><script src="https://code.jquery.com/jquery-3.1.0.min.js"   integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s="   crossorigin="anonymous"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js" integrity="sha384-s1ITto93iSMDxlp/79qhWHi+LsIi9Gx6yL+cOKDuymvihkfol83TYbLbOw+W/wv4" crossorigin="anonymous"></script><!-- Open internal javascript --><script>
  $(document).ready(function() {
    // Instructions expand/collapse
    var content = $('#instructionBody');
    var trigger = $('#collapseTrigger');
    content.hide();
    $('.collapse-text').text('(Click to expand)');
    trigger.click(function(){
      content.toggle();
      var isVisible = content.is(':visible');
      if(isVisible){
        $('.collapse-text').text('(Click to collapse)');
      }else{
        $('.collapse-text').text('(Click to expand)');
      }
    });
    // end expand/collapse
  });
</script><!-- Close internal javascript -->
